<!DOCTYPE html>
<html lang="es_ES">
    <head>
        <title>HackForFun | Precios</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="UTF-8">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="../css/precios.css">
        <link rel="icon" href="../icono/logo_hack4fun_H_whiteblue.ico" type="image/x-icon">
    </head>
    <body>
        <nav>
            <div id="inicio" onclick="window.location.href='../index.html';">
                <img src="../icono/logo_hack4fun_bluewhite.png" alt="HackForFun Logo"/>
            </div>
            <div id="nav">
                <a href="aprendizaje.html">Aprendizaje</a>
                <a href="servicios.html">Servicios</a>
                <a href="precios.html">Precios</a>
                <a href="contacto.html">Contacto</a>
            </div>
            <div id="botones">
                <a id="empresas" href="../php/register-empresas.php">Empresas</a>
                <a class="boton" href="../php/register.php">Registrarse</a>
                <a class="boton" href="../php/login.php">Iniciar sesión</a>
            </div>
        </nav>

        <div id="docker">
            <div class="price-box">
                <h2>Suscripción H4F</h2>
                <h3>13.99€</h3>
                <p>
                    Suscripción a Hack For Fun de nivel estándar. Adéntrate en el mundo de la ciberseguridad de una forma económica
                </p>
                <ul>
                    <li>Acceso a todas las máquinas del laboratorio</li>
                    <li>Acceso a todo el contenido de la academia</li>
                    <li>Soporte técnico 24/7</li>
                    <li>VPN Colectiva</li>
                </ul>
                <a href="../php/machines/cooming-soon.php" class="boton-sale">Suscribirse</a>
            </div>

            <div class="price-box premium">
                <h2>Suscripción H4F Hacker</h2>
                <h3>19.99€</h3>
                <p>
                    Suscripción a Hack For Fun de nivel superior. Adéntrate en el mundo de la ciberseguridad de la mejor manera posible
                </p>
                <ul>
                    <li>Acceso a todas las máquinas del laboratorio</li>
                    <li>Acceso a todo el contenido de la academia</li>
                    <li>Soporte técnico 24/7</li>
                    <li>Acceso a máquinas retiradas</li>
                    <li>VPN Privada</li>
                    <li>Beneficios por participación en la creación de máquinas</li>
                </ul>
                <a href="../php/machines/cooming-soon.php" class="boton-sale">Suscribirse</a>
            </div>
        </div>
        <div id="login-popup" class="popup-backdrop">
            <div class="popup-content">
                <span class="close-btn" onclick="closeLoginPopup()">&times;</span>
                <h2>Iniciar sesión</h2>
                <form id="login-form" method="post" action="../php/login.php">
                    <div id="error-message" style="color: red; display: none;"></div>
                    <label for="correo">Email o nombre de usuario:</label><br>
                    <input type="text" name="correo" id="popup-correo" required><br><br>
                    <label for="password">Contraseña:</label><br>
                    <input type="password" name="password" id="popup-password" required><br><br>
                    <input class="boton" type="submit" value="Iniciar sesión">
                </form>
            </div>
        </div>
        <div id="empresas-popup" class="popup-backdrop">
            <div class="popup-content">
                <span class="close-btn" onclick="closeEmpresasPopup()">&times;</span>
                <h2>Registro para Empresas</h2>
                <form id="empresas-form" method="post" action="../php/register-empresas.php">
                    <div id="empresas-error-message" style="color: red; display: none;"></div>
                    <label for="nombreemp">Nombre de la Empresa:</label><br>
                    <input type="text" name="nombreemp" id="nombreemp" required><br><br>
                    <label for="areaprof">Área profesional:</label><br>
                    <input type="text" name="areaprof" id="areaprof" required><br><br>
                    <label for="dir">Dirección:</label><br>
                    <input type="text" name="dir" id="dir" required><br><br>
                    <label for="correo">Email:</label><br>
                    <input type="email" name="correo" id="correo" required><br><br>
                    <label for="numerotrabj">Número de trabajadores:</label><br>
                    <input type="text" name="numerotrabj" id="numerotrabj" required><br><br>
                    <input class="boton" type="submit" value="Registrarse">
                    <input class="boton" type="button" onclick="closeEmpresasPopup()" value="Cancelar">
                </form>
            </div>
        </div>
        <div id="register-popup" class="popup-backdrop">
            <div class="popup-content">
                <span class="close-btn" onclick="closeRegisterPopup()">&times;</span>
                <h2>Registro de usuario</h2>
                <form id="register-form" method="post" action="../php/register.php">
                    <div id="register-error-message" style="color: red; display: none;"></div>
                    <label for="nombre">Nombre:</label><br>
                    <input type="text" name="nombre" id="nombre" required><br><br>
                    <label for="apellidos">Apellidos:</label><br>
                    <input type="text" name="apellidos" id="apellidos" required><br><br>
                    <label for="username">Nombre de usuario:</label><br>
                    <input type="text" name="username" id="username" required><br><br>
                    <label for="correo">Email:</label><br>
                    <input type="email" name="correo" id="correo" required><br><br>
                    <label for="password">Contraseña:</label><br>
                    <input type="password" name="password" id="password" required><br><br>
                    <label for="passwordcheck">Repetir Contraseña:</label><br>
                    <input type="password" name="passwordcheck" id="passwordcheck" required><br><br>
                    <input class="boton" type="submit" value="Registrarse">
                    <input class="boton" type="button" onclick="closeRegisterPopup()" value="Cancelar">
                </form>
            </div>
        </div>
        <footer>
            <div>
                <div id="logo" onclick="window.location.href='../index.html';">
                    <img src="../icono/logo_hack4fun_bluewhite.png"/>
                </div>
            </div>
            <div id="menu-footer">
                <h3><a href="aprendizaje.html">Aprendizaje</a></h3><br>
                <h3><a href="servicios.html">Servicios</a></h3><br>
                <h3><a href="precios.html">Precios</a></h3><br>
                <h3><a href="contacto.html">Contacto</a></h3><br>
            </div>
            <div id="info-footer">
                <h3 style="text-transform: uppercase;"><a href="../legalidad/PrivacidadYDatos.html">Política de Privacidad y Datos</a></h3><br>
                <h3 style="text-transform: uppercase;"><a href="../legalidad/TerminosYCondiciones.html">Términos y condiciones</a></h3><br>
                <h3>HackForFun S.L.</h3>
                <h4>Calle Francisco Bores, 3</h4>
                <h4>Trabajo Final de Grado Superior de ASIR</h4>
                <h4>IES Calderón de la Barca, Pinto</h4>
            </div>
        </footer>
        <script>
            // Función genérica para abrir popups
            function openPopup(e, popupId) {
                e.preventDefault();
                document.getElementById(popupId).style.display = 'block';
                document.body.classList.add('popup-open');
            }
        
            // Funciones específicas para cada popup
            function openLoginPopup(e) { openPopup(e, 'login-popup'); }
            function openEmpresasPopup(e) { openPopup(e, 'empresas-popup'); }
            function openRegisterPopup(e) { openPopup(e, 'register-popup'); }
        
            // Función genérica para cerrar popups
            function closePopup(popupId) {
                document.getElementById(popupId).style.display = 'none';
                document.body.classList.remove('popup-open');
            }
        
            // Funciones específicas para cada popup
            function closeLoginPopup() { closePopup('login-popup'); }
            function closeEmpresasPopup() { closePopup('empresas-popup'); }
            function closeRegisterPopup() { closePopup('register-popup'); }
        
            // Asignar eventos al cargar la página
            document.addEventListener('DOMContentLoaded', function() {
                // Botón de login
                document.querySelector('a.boton[href="../php/login.php"]')?.addEventListener('click', openLoginPopup);
                
                // Enlace de Empresas
                document.querySelector('a#empresas[href="../php/register-empresas.php"]')?.addEventListener('click', openEmpresasPopup);
                
                // Botón de Registro
                document.querySelector('a.boton[href="../php/register.php"]')?.addEventListener('click', openRegisterPopup);
        
                // Cerrar al hacer clic fuera del contenido (para los 3 popups)
                document.getElementById('login-popup')?.addEventListener('click', function(e) {
                    if (e.target === this) closeLoginPopup();
                });
        
                document.getElementById('empresas-popup')?.addEventListener('click', function(e) {
                    if (e.target === this) closeEmpresasPopup();
                });
        
                document.getElementById('register-popup')?.addEventListener('click', function(e) {
                    if (e.target === this) closeRegisterPopup();
                });
        
                // Manejar envío de formularios con AJAX (similar para los 3)
                document.getElementById('login-form')?.addEventListener('submit', handleFormSubmit);
                document.getElementById('empresas-form')?.addEventListener('submit', handleFormSubmit);
                document.getElementById('register-form')?.addEventListener('submit', handleFormSubmit);
            });
        
                // Función específica para manejar login
                function handleLoginSubmit(e) {
                    e.preventDefault();
                    const form = e.target;
                    const errorElement = form.querySelector('[id$="-error-message"]');
                    
                    fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Redirigir sin mostrar alert
                            if (data.redirect) {
                                window.location.href = data.redirect;
                            }
                        } else {
                            errorElement.textContent = data.error || 'Error desconocido';
                            errorElement.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        errorElement.textContent = 'Error al procesar la solicitud';
                        errorElement.style.display = 'block';
                    });
                }

                // Función genérica para manejar registros (empresas y usuarios)
                function handleRegisterSubmit(e) {
                    e.preventDefault();
                    const form = e.target;
                    const errorElement = form.querySelector('[id$="-error-message"]');
                    
                    fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Mostrar mensaje de éxito solo para registros
                            if (data.message) {
                                alert(data.message);
                            }
                            
                            // Redirigir después de mostrar el alert
                            if (data.redirect) {
                                window.location.href = data.redirect;
                            }
                        } else {
                            errorElement.textContent = data.error || 'Error desconocido';
                            errorElement.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        errorElement.textContent = 'Error al procesar la solicitud';
                        errorElement.style.display = 'block';
                    });
                }

                // Asignar eventos al cargar la página
                document.addEventListener('DOMContentLoaded', function() {
                    // [Los event listeners para abrir popups se mantienen igual...]
                    
                    // Asignar manejadores específicos para cada formulario
                    document.getElementById('login-form')?.addEventListener('submit', handleLoginSubmit);
                    document.getElementById('empresas-form')?.addEventListener('submit', handleRegisterSubmit);
                    document.getElementById('register-form')?.addEventListener('submit', handleRegisterSubmit);
                });
        </script>
    </body>
</html>
